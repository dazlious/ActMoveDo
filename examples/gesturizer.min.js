/*! gesturizer, version 0.9.1, copyright by Michael Duve | 2015-07-26 */
var gesturizer=gesturizer||function(a){"use strict";function b(b){this.settings={container:".gesturizer",isTouchDevice:this.checkTouch(),isMouseDevice:this.checkMouse(),timeTreshold:{tap:200,doubletap:200,hold:500,swipe:300,flick:50},distanceTreshold:{swipe:180},autoFireHold:null,callbacks:{tap:null,tapHold:null,doubletap:null,hold:null,pan:null,swipe:null,flick:null,zoom:null,wheel:null,pinch:null}},this.settings.eventNames={start:{touch:"touchstart",mouse:"mousedown"},move:{touch:"touchmove",mouse:"mousemove"},end:{touch:"touchend",mouse:"mouseup"},scroll:this.getScrollEventName()},a.extend(!0,this.settings,b||{}),this.current={downEvent:!1,hasMoved:!1,multitouch:!1,lastAction:null,start:null,move:null,end:null,time:null,timeStart:null,timeEnd:null,timeout:null,holdTimeout:null},this.init(),this.bindEvents()}return b.prototype.init=function(){this.$container=a(this.settings.container),this.container=a(this.settings.container)[0]},b.prototype.bindEvents=function(){this.settings.isTouchDevice&&this.bindTouchEvents(),this.settings.isMouseDevice&&this.bindMouseEvents()},b.prototype.bindTouchEvents=function(){this.$container.on(this.settings.eventNames.start.touch,this.startHandler.bind(this)),this.$container.on(this.settings.eventNames.move.touch,this.moveHandler.bind(this)),this.$container.on(this.settings.eventNames.end.touch,this.endHandler.bind(this))},b.prototype.bindMouseEvents=function(){this.$container.on(this.settings.eventNames.scroll,this.scrollHandler.bind(this)),this.$container.on(this.settings.eventNames.start.mouse,this.startHandler.bind(this)),this.$container.on(this.settings.eventNames.move.mouse,this.moveHandler.bind(this)),this.$container.on(this.settings.eventNames.end.mouse,this.endHandler.bind(this))},b.prototype.scrollHandler=function(a){a=a||window.event,a.stopPropagation(),a.preventDefault();var b=this.getEvent(a)||a.originalEvent,c=this.getScrollDirection(b),d=this.getRelativePosition(b);this.settings.callbacks.wheel&&this.eventCallback(this.settings.callbacks.wheel,{target:a.target,directions:c,position:d}),this.settings.callbacks.zoom&&this.eventCallback(this.settings.callbacks.zoom,{target:a.target,direction:c.indexOf("up")>-1?"in":c.indexOf("down")>-1?"out":"none",position:d,factor:c.indexOf("up")>-1?1:c.indexOf("down")>-1?-1:0})},b.prototype.startHandler=function(a){a.stopPropagation(),a.preventDefault();var b=this.getEvent(a);if(this.current.target=a.target,this.current.downEvent=!0,this.current.timeStart=a.timeStamp,this.current.timeout&&(this.current.timeout=clearTimeout(this.current.timeout)),b instanceof MouseEvent)this.current.start=this.getRelativePosition(b);else if(b.length<=1)this.current.start=this.getRelativePosition(b[0]);else if(2===b.length){this.current.multitouch=!0;var c=this.getRelativePosition(b[0]),d=this.getRelativePosition(b[1]);this.current.distance=this.getDistance(c,d),this.current.start=[(c[0]+d[0])/2,(c[1]+d[1])/2]}switch(this.current.lastAction){case null:this.current.lastAction="tap",this.settings.autoFireHold&&this.setTimeoutForEvent(this.settings.callbacks.hold,this.settings.autoFireHold,{target:this.current.target,positions:{start:this.current.start}},!0);break;case"tap":this.current.lastAction="doubletap",this.settings.autoFireHold&&this.setTimeoutForEvent(this.settings.callbacks.tapHold,this.settings.autoFireHold,{target:this.current.target,positions:{start:this.current.start}},!0)}},b.prototype.moveHandler=function(a){if(!this.current.downEvent)return!1;this.current.timeout&&(this.current.timeout=clearTimeout(this.current.timeout)),this.current.holdTimeout&&(this.current.holdTimeout=clearTimeout(this.current.holdTimeout)),this.current.hasMoved=!0,this.current.lastAction="move",a.stopPropagation(),a.preventDefault();var b,c,d=this.getEvent(a),e=this.current.move?this.current.move:this.current.start,f=this.current.time?this.current.time:this.current.timeStart,g=a.timeStamp;if(this.current.time=a.timeStamp,d instanceof MouseEvent)b=this.getRelativePosition(d),c=this.getDistance(e,b);else if(d.length<=1)b=this.getRelativePosition(d[0]),c=this.getDistance(e,b);else if(2===d.length){var h=this.getRelativePosition(d[0]),i=this.getRelativePosition(d[1]);c=this.getDistance(h,i),b=[(h[0]+i[0])/2,(h[1]+i[1])/2]}var j=g-f;this.current.multitouch?(this.current.difference=c-this.current.distance,this.current.distance=c,this.current.oldMove=this.current.move,this.current.move=b,this.settings.callbacks.pinch&&this.eventCallback(this.settings.callbacks.pinch,{target:a.target,positions:{start:this.current.start,current:this.current.move,last:this.current.oldMove},distance:{current:c,differenceToLast:this.current.difference}}),this.settings.callbacks.zoom&&this.eventCallback(this.settings.callbacks.zoom,{target:a.target,positions:{start:this.current.start,current:this.current.move,last:this.current.oldMove},direction:this.current.difference<0?"out":this.current.difference>0?"in":"none",factor:this.current.difference})):(this.current.speed=this.calculateSpeed(c,j),this.current.oldMove=this.current.move,this.current.move=b,this.eventCallback(this.settings.callbacks.pan,{target:this.current.target,positions:{start:this.current.start,current:this.current.move,last:e},timeElapsed:{sinceLast:j,sinceStart:g-this.current.timeStart},distanceToLastPoint:c,speed:this.current.speed}))},b.prototype.endHandler=function(a){a.stopPropagation(),a.preventDefault();var b=this.getEvent(a);this.current.timeEnd=a.timeStamp;var c=this.current.timeEnd-this.current.timeStart,d=this.current.timeEnd-this.current.time;if(this.current.holdTimeout&&(this.current.holdTimeout=clearTimeout(this.current.holdTimeout)),b instanceof MouseEvent?this.current.end=this.getRelativePosition(b):b.length<=1&&(this.current.end=this.getRelativePosition(b[0])),this.current.hasMoved||!this.current.downEvent||this.current.multitouch){if(this.current.hasMoved&&this.current.downEvent&&!this.current.multitouch){if(this.settings.callbacks.swipe||this.settings.callbacks.flick){var e;this.settings.callbacks.swipe?e=[this.current.end[0]-this.current.start[0],this.current.end[1]-this.current.start[1]]:this.settings.callbacks.flick&&(e=[this.current.end[0]-this.current.oldMove[0],this.current.end[1]-this.current.oldMove[1]]);var f=this.vectorLength(e),g=[e[0]/f,e[1]/f],h=this.getDistance(this.current.end,this.current.start),i=this.calculateSpeed(h,c);if(this.settings.callbacks.swipe&&c<=this.settings.timeTreshold.swipe){var j=this.getAbsolutePosition(this.container,this.current.start),k=this.getAbsolutePosition(this.container,this.current.end);if(this.getDistance(k,j)>=this.settings.distanceTreshold.swipe){var l=this.getSwipeDirections(g);this.eventCallback(this.settings.callbacks.swipe,{positions:{start:this.current.start,end:this.current.end},speed:i,directions:{named:l,detailed:g}})}}this.settings.callbacks.flick&&d<=this.settings.timeTreshold.flick&&this.eventCallback(this.settings.callbacks.flick,{speed:i,direction:g,positions:{start:this.current.start,end:this.current.end}})}switch(this.current.lastAction){default:this.current.lastAction=null}}}else switch(this.current.lastAction){case"tap":c<this.settings.timeTreshold.hold?this.setTimeoutForEvent(this.settings.callbacks.tap,this.settings.timeTreshold.tap,{target:this.current.target,positions:{start:this.current.start}}):this.eventCallback(this.settings.callbacks.hold,{target:this.current.target,positions:{start:this.current.start}});break;case"doubletap":c<this.settings.timeTreshold.hold?this.setTimeoutForEvent(this.settings.callbacks.doubletap,this.settings.timeTreshold.doubletap,{target:this.current.target,positions:{start:this.current.start,end:this.current.end}}):this.eventCallback(this.settings.callbacks.tapHold,{target:this.current.target,positions:{start:this.current.start,end:this.current.end}});break;default:this.current.lastAction=null}this.current.downEvent=!1,this.current.hasMoved=!1,this.current.multitouch=!1},b.prototype.calculateSpeed=function(a,b){return a/b*100},b.prototype.getSwipeDirections=function(a){var b=[];return a[0]<0&&b.push("left"),a[0]>0&&b.push("right"),a[1]<0&&b.push("up"),a[1]>0&&b.push("down"),b},b.prototype.vectorLength=function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])},b.prototype.setTimeoutForEvent=function(a,b,c,d){d?this.current.holdTimeout=setTimeout(this.eventCallback.bind(this,a,c),b):this.current.timeout=setTimeout(this.eventCallback.bind(this,a,c),b)},b.prototype.eventCallback=function(a,b){a&&("string"==typeof a?this.$container.trigger({type:a,gesturizer:b}):"function"==typeof a&&a(b)),this.current.lastAction=null},b.prototype.getRelativePosition=function(a){var b=this.container,c=b.getBoundingClientRect(),d=(a.clientX-c.left)/c.width,e=(a.clientY-c.top)/c.height;return[d,e]},b.prototype.getAbsolutePosition=function(a,b){var c=a.getBoundingClientRect(),d=b[0]*c.width,e=b[1]*c.height;return[d,e]},b.prototype.getDistance=function(a,b){var c=a[0]-b[0],d=a[1]-b[1];return Math.sqrt(c*c+d*d)},b.prototype.getScrollDirection=function(a){var b=parseInt(a.axis,10),c=[];return a.wheelDelta<0||a.deltaY>0||a.wheelDeltaY<0||2===b&&a.detail>0?c.push("down"):(a.wheelDelta>0||a.deltaY<0||a.wheelDeltaY>0||2===b&&a.detail<0)&&c.push("up"),a.deltaX>0||a.wheelDeltaX>0||1===b&&a.detail>0?c.push("right"):(a.deltaX<0||a.wheelDeltaX<0||1===b&&a.detail<0)&&c.push("left"),c},b.prototype.checkTouch=function(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0},b.prototype.checkMouse=function(){return"onmousedown"in window},b.prototype.getScrollEventName=function(){return"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll"},b.prototype.getEvent=function(a){return jQuery.event.fix(a),a.originalEvent.touches&&0===a.originalEvent.touches.length?a.originalEvent.changedTouches||a.originalEvent:a.originalEvent.touches||a.originalEvent.changedTouches||a.originalEvent},b}(jQuery);